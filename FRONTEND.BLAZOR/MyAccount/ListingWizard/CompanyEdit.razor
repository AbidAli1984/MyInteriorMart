@page "/MyAccount/ListingWizard/CompanyEdit/{listingId:int?}"
@inject ListingDbContext listingContext
@inject AuditDbContext auditContext
@inject CategoriesDbContext categoriesContext
@inject SharedDbContext sharedContext
@inject AuthenticationStateProvider authenticationState
@inject NotificationService _notice
@inject NavigationManager navManager
@using BOL.SHARED
@inject IJSRuntime jsRuntime

    <AuthorizeView>
        <Authorized>
            <div class="container">
                <div class="listing-from-block individual-listing">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="nav profile-side-menu flex-column nav-pills" id="v-pills-tab-listing" role="tablist"
                                 aria-orientation="vertical">
                                <!-- Company -->
                                @if (companyExist == true)
                                {
                                    if (currentPage == "nav-company")
                                    {
                                        <a class="nav-link active" href="/MyAccount/ListingWizard/CompanyEdit/@listingId" aria-selected="true">Company</a>
                                    }
                                    else
                                    {
                                        <a class="nav-link" href="/MyAccount/ListingWizard/CompanyEdit/@listingId" aria-selected="false">Company</a>
                                    }
                                }
                                else
                                {
                                    if (currentPage == "nav-company")
                                    {
                                        <a class="nav-link active" href="/MyAccount/ListingWizard/Company/" aria-selected="true">Company</a>
                                    }
                                    else
                                    {
                                        <a class="nav-link" href="#0" aria-selected="false">Company</a>
                                    }
                                }

                                <!-- Communication -->
                                @if (communicationExist == true)
                                {
                                    if (currentPage == "nav-communication")
                                    {
                                        <a class="nav-link active" href="/MyAccount/ListingWizard/CommunicationEdit/@listingId" aria-selected="true">Communication</a>
                                    }
                                    else
                                    {
                                        <a class="nav-link" href="/MyAccount/ListingWizard/CommunicationEdit/@listingId" aria-selected="false">Communication</a>
                                    }
                                }
                                else
                                {
                                    if (currentPage == "nav-communication")
                                    {
                                        <a class="nav-link active" href="/MyAccount/ListingWizard/Communication/" aria-selected="true">Communication</a>
                                    }
                                    else
                                    {
                                        <a class="nav-link" href="javascript:void(0)" aria-selected="false">Communication</a>
                                    }
                                }

                                <!-- Address -->
                                @if (addressExist == true)
                                {
                                    if (currentPage == "nav-address")
                                    {
                                        <a class="nav-link active" href="/MyAccount/ListingWizard/AddressEdit/@listingId" aria-selected="true">Address</a>
                                    }
                                    else
                                    {
                                        <a class="nav-link" href="/MyAccount/ListingWizard/AddressEdit/@listingId" aria-selected="false">Address</a>
                                    }
                                }
                                else
                                {
                                    if (currentPage == "nav-address")
                                    {
                                        <a class="nav-link active" href="/MyAccount/ListingWizard/Address/" aria-selected="true">Address</a>
                                    }
                                    else
                                    {
                                        <a class="nav-link" href="javascript:void(0)" aria-selected="false">Address</a>
                                    }
                                }

                                <!-- Categories -->
                                @if (categoryExist == true)
                                {
                                    if (currentPage == "nav-category")
                                    {
                                        <a class="nav-link active" href="/MyAccount/ListingWizard/CategoryEdit/@listingId" aria-selected="true">Category</a>
                                    }
                                    else
                                    {
                                        <a class="nav-link" href="/MyAccount/ListingWizard/CategoryEdit/@listingId" aria-selected="false">Category</a>
                                    }
                                }
                                else
                                {
                                    if (currentPage == "nav-category")
                                    {
                                        <a class="nav-link active" href="/MyAccount/ListingWizard/Category/" aria-selected="true">Category</a>
                                    }
                                    else
                                    {
                                        <a class="nav-link" href="javascript:void(0)" aria-selected="false">Category</a>
                                    }
                                }

                                <!-- Specialisations -->
                                @if (specialisationExist == true)
                                {
                                    if (currentPage == "nav-specialisation")
                                    {
                                        <a class="nav-link active" href="/MyAccount/ListingWizard/SpecialisationEdit/@listingId" aria-selected="true">Specialisation</a>
                                    }
                                    else
                                    {
                                        <a class="nav-link" href="/MyAccount/ListingWizard/SpecialisationEdit/@listingId" aria-selected="false">Specialisation</a>
                                    }
                                }
                                else
                                {
                                    if (currentPage == "nav-specialisation")
                                    {
                                        <a class="nav-link active" href="/MyAccount/ListingWizard/Specialisation/" aria-selected="true">Specialisation</a>
                                    }
                                    else
                                    {
                                        <a class="nav-link" href="javascript:void(0)" aria-selected="false">Specialisation</a>
                                    }
                                }

                                <!-- Working Hours -->
                                @if (workingHoursExist == true)
                                {
                                    if (currentPage == "nav-workinghours")
                                    {
                                        <a class="nav-link active" href="/MyAccount/ListingWizard/WorkingHoursEdit/@listingId" aria-selected="true">Working Hours</a>
                                    }
                                    else
                                    {
                                        <a class="nav-link" href="/MyAccount/ListingWizard/WorkingHoursEdit/@listingId" aria-selected="false">Working Hours</a>
                                    }
                                }
                                else
                                {
                                    if (currentPage == "nav-workinghours")
                                    {
                                        <a class="nav-link active" href="/MyAccount/ListingWizard/WorkingHours/" aria-selected="true">Working Hours</a>
                                    }
                                    else
                                    {
                                        <a class="nav-link" href="javascript:void(0)" aria-selected="false">Working Hours</a>
                                    }
                                }

                                <!-- Payment Modes -->
                                @if (paymentModeExist == true)
                                {
                                    if (currentPage == "nav-paymentmode")
                                    {
                                        <a class="nav-link active" href="/MyAccount/ListingWizard/PaymentModeEdit/@listingId" aria-selected="true">Payment Mode</a>
                                    }
                                    else
                                    {
                                        <a class="nav-link" href="/MyAccount/ListingWizard/PaymentModeEdit/@listingId" aria-selected="false">Payment Mode</a>
                                    }
                                }
                                else
                                {
                                    if (currentPage == "nav-paymentmode")
                                    {
                                        <a class="nav-link active" href="/MyAccount/ListingWizard/PaymentMode/" aria-selected="true">Payment Mode</a>
                                    }
                                    else
                                    {
                                        <a class="nav-link" href="javascript:void(0)" aria-selected="false">Payment Mode</a>
                                    }
                                }
                                <!-- End: Listing Wizard -->
                                <!-- Begin: Finish -->
                                @if (currentPage == "nav-logo")
                                {
                                    <a class="nav-link active" href="/MyAccount/ListingWizard/Logo/@listingId" aria-selected="true">Logo</a>
                                }
                                else
                                {
                                    <a class="nav-link" href="/MyAccount/ListingWizard/Logo/@listingId" aria-selected="false">Logo</a>
                                }
                                @if (currentPage == "nav-finish")
                                {
                                    <a class="nav-link active" href="javascript:void(0)" aria-selected="true">Finish</a>
                                }
                                <!-- End: Finish -->
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="tab-content profile-sidebar-content add-lidting" id="v-pills-tabContent">
                                <div class="tab-pane fade show active" id="v-pills-Company" role="tabpanel"
                                     aria-labelledby="v-pills-Company-tab">
                                    <p class="add-lidting-title-from">Edit Company Details <button class="btn btn-link float-right" @onclick="@(async() => await ToggleEditAsync())">Edit</button></p>
                                    <div class="row">
                                        <div class="form-group col-md-4">
                                            <label for="name">Name <span class="text-danger">*</span></label>
                                            <Input Placeholder="Full Name" @bind-Value="@Name" disabled="@toggleEdit" />
                                        </div>
                                        <div class="form-group col-md-4">
                                            <label>Gander <span class="text-danger">*</span></label>
                                            <Select DataSource="@genderList"
                                                    @bind-Value="@Gender"
                                                    LabelName="@nameof(Genders.Name)"
                                                    ValueName="@nameof(Genders.Value)"
                                                    Placeholder="Select Gender"
                                                    DisabledName="@nameof(Genders.NotAvailable)"
                                                    DefaultActiveFirstItem="false"
                                                    EnableSearch
                                                    disabled="@toggleEdit">
                                            </Select>
                                        </div>
                                        <div class="form-group col-md-4">
                                            <label class="control-label">
                                                Year Of Establishment <span class="text-danger">*</span>
                                            </label>
                                            <DatePicker @bind-Value="@YearOfEstablishment" Picker="@DatePickerType.Year" />
                                        </div>
                                        <div class="form-group col-md-4">
                                            <label>Company Name <span class="text-danger">*</span></label>
                                            <Input Placeholder="Company Name" @bind-Value="@CompanyName" disabled="@toggleEdit" />
                                        </div>
                                        <div class="form-group col-md-4">
                                            <label class="control-label" for="Turnover">
                                                Turnover <span class="text-danger">*</span>
                                            </label>
                                            <Select DataSource="@turnoverList"
                                                    @bind-Value="@Turnover"
                                                    LabelName="@nameof(Turnovers.Name)"
                                                    ValueName="@nameof(Turnovers.Value)"
                                                    Placeholder="Select Gender"
                                                    DefaultActiveFirstItem="false"
                                                    EnableSearch
                                                    disabled="@toggleEdit">
                                            </Select>
                                        </div>
                                        <div class="form-group col-md-4">
                                            <label>Number of Employees <span class="text-danger">*</span></label>
                                            <Input Placeholder="Company Name" @bind-Value="@NumberOfEmployees" disabled="@toggleEdit" />
                                        </div>
                                        <div class="form-group col-md-4">
                                            <label>Nature of business <span class="text-danger">*</span></label>
                                            <Select DataSource="@natureOfBusinessList"
                                                    @bind-Value="@NOB"
                                                    LabelName="@nameof(NatureOfBusiness.Name)"
                                                    ValueName="@nameof(NatureOfBusiness.Name)"
                                                    Placeholder="Select Nature of Business"
                                                    DefaultActiveFirstItem="false"
                                                    EnableSearch
                                                    disabled="@toggleEdit">
                                            </Select>
                                        </div>
                                        <div class="form-group col-md-4">
                                            <label>Designation <span class="text-danger">*</span></label>
                                            <Select DataSource="@designationList"
                                                    @bind-Value="@DesignationV"
                                                    LabelName="@nameof(Designation.Name)"
                                                    ValueName="@nameof(Designation.Name)"
                                                    Placeholder="Select Designations"
                                                    DefaultActiveFirstItem="false"
                                                    EnableSearch
                                                    disabled="@toggleEdit">
                                            </Select>
                                        </div>
                                        <div class="text-left col-12 mt-3">
                                            @if (toggleEdit == false)
                                            {
                                                if (buttonBusy == false)
                                                {
                                                    <button @onclick="@(async() => await UpdateCompanyAsync())" class="btn_1" disabled="@toggleEdit">Save & Continue</button>
                                                }
                                                else
                                                {
                                                    <button class="btn_1">Saving...</button>
                                                }
                                            }

                                            @if (communicationExist == true && toggleEdit == true)
                                            {
                                                <a href="/MyAccount/ListingWizard/CommunicationEdit/@listingId" class="pull-right mr-2"><img src="/img/arrow-next.png" height="25" /></a>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </Authorized>
        <NotAuthorized>
            <UnAuthorizedUser />
        </NotAuthorized>
    </AuthorizeView>